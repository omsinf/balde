// @ts-check
const iiifRefs = {
    "lyrica_1643": {
        "manifest": "https://api.digitale-sammlungen.de/iiif/presentation/v2/bsb11270675/manifest",
        "pages": {
            "lyr-1-1": 7,
            "lyr-1-2": 9,
            "lyr-1-3": 11,
            "lyr-1-4": 12,
            "lyr-1-5": 13,
            "lyr-1-6": 15,
            "lyr-1-7": 16,
            "lyr-1-8": 17,
            "lyr-1-9": 18,
            "lyr-1-10": 19,
            "lyr-1-11": 21,
            "lyr-1-12": 22,
            "lyr-1-13": 23,
            "lyr-1-14": 24,
            "lyr-1-15": 25,
            "lyr-1-16": 26,
            "lyr-1-17": 28,
            "lyr-1-18": 28,
            "lyr-1-19": 30,
            "lyr-1-20": 31,
            "lyr-1-21": 34,
            "lyr-1-22": 35,
            "lyr-1-23": 36,
            "lyr-1-24": 38,
            "lyr-1-25": 39,
            "lyr-1-26": 41,
            "lyr-1-27": 42,
            "lyr-1-28": 43,
            "lyr-1-29": 44,
            "lyr-1-30": 45,
            "lyr-1-31": 46,
            "lyr-1-32": 47,
            "lyr-1-33": 47,
            "lyr-1-34": 50,
            "lyr-1-35": 51,
            "lyr-1-36": 54,
            "lyr-1-37": 54,
            "lyr-1-38": 55,
            "lyr-1-39": 56,
            "lyr-1-40": 59,
            "lyr-1-41": 60,
            "lyr-1-42": 62,
            "lyr-1-43": 63,
            "lyr-2-1": 65,
            "lyr-2-2": 67,
            "lyr-2-3": 68,
            "lyr-2-4": 71,
            "lyr-2-5": 71,
            "lyr-2-6": 72,
            "lyr-2-7": 74,
            "lyr-2-8": 74,
            "lyr-2-9": 76,
            "lyr-2-10": 76,
            "lyr-2-11": 79,
            "lyr-2-12": 80,
            "lyr-2-13": 81,
            "lyr-2-14": 85,
            "lyr-2-15": 86,
            "lyr-2-16": 87,
            "lyr-2-17": 88,
            "lyr-2-18": 90,
            "lyr-2-19": 90,
            "lyr-2-20": 94,
            "lyr-2-21": 96,
            "lyr-2-22": 97,
            "lyr-2-23": 98,
            "lyr-2-24": 99,
            "lyr-2-25": 100,
            "lyr-2-26": 101,
            "lyr-2-27": 104,
            "lyr-2-28": 105,
            "lyr-2-29": 107,
            "lyr-2-30": 108,
            "lyr-2-31": 110,
            "lyr-2-32": 111,
            "lyr-2-33": 111,
            "lyr-2-34": 112,
            "lyr-2-35": 113,
            "lyr-2-36": 114,
            "lyr-2-37": 116,
            "lyr-2-38": 117,
            "lyr-2-39": 119,
            "lyr-2-40": 122,
            "lyr-2-41": 123,
            "lyr-2-42": 123,
            "lyr-2-43": 125,
            "lyr-2-44": 127,
            "lyr-2-45": 127,
            "lyr-2-46": 128,
            "lyr-2-47": 129,
            "lyr-2-48": 130,
            "lyr-2-49": 130,
            "lyr-2-50": 131,
            "lyr-3-1": 135,
            "lyr-3-2": 138,
            "lyr-3-3": 139,
            "lyr-3-4": 139,
            "lyr-3-5": 142,
            "lyr-3-6": 143,
            "lyr-3-7": 144,
            "lyr-3-8": 145,
            "lyr-3-9": 147,
            "lyr-3-10": 148,
            "lyr-3-11": 149,
            "lyr-3-12": 150,
            "lyr-3-13": 151,
            "lyr-3-14": 154,
            "lyr-3-15": 155,
            "lyr-3-16": 157,
            "lyr-3-17": 158,
            "lyr-3-18": 159,
            "lyr-3-19": 160,
            "lyr-3-20": 161,
            "lyr-3-21": 162,
            "lyr-3-22": 163,
            "lyr-3-23": 164,
            "lyr-3-24": 166,
            "lyr-3-25": 167,
            "lyr-3-26": 168,
            "lyr-3-27": 170,
            "lyr-3-28": 171,
            "lyr-3-29": 171,
            "lyr-3-30": 172,
            "lyr-3-31": 175,
            "lyr-3-32": 176,
            "lyr-3-33": 179,
            "lyr-3-34": 180,
            "lyr-3-35": 182,
            "lyr-3-36": 184,
            "lyr-3-37": 185,
            "lyr-3-38": 186,
            "lyr-3-39": 188,
            "lyr-3-40": 190,
            "lyr-3-41": 191,
            "lyr-3-42": 192,
            "lyr-3-43": 194,
            "lyr-3-44": 195,
            "lyr-3-45": 196,
            "lyr-3-46": 199,
            "lyr-3-47": 200,
            "lyr-3-48": 203,
            "lyr-4-1": 205,
            "lyr-4-2": 210,
            "lyr-4-3": 212,
            "lyr-4-4": 215,
            "lyr-4-5": 217,
            "lyr-4-6": 218,
            "lyr-4-7": 219,
            "lyr-4-8": 219,
            "lyr-4-9": 220,
            "lyr-4-10": 224,
            "lyr-4-11": 226,
            "lyr-4-12": 228,
            "lyr-4-13": 228,
            "lyr-4-14": 230,
            "lyr-4-15": 233,
            "lyr-4-16": 233,
            "lyr-4-17": 235,
            "lyr-4-18": 236,
            "lyr-4-19": 237,
            "lyr-4-20": 238,
            "lyr-4-21": 239,
            "lyr-4-22": 240,
            "lyr-4-23": 242,
            "lyr-4-24": 244,
            "lyr-4-25": 246,
            "lyr-4-26": 247,
            "lyr-4-27": 248,
            "lyr-4-28": 251,
            "lyr-4-29": 252,
            "lyr-4-30": 253,
            "lyr-4-31": 255,
            "lyr-4-32": 256,
            "lyr-4-33": 256,
            "lyr-4-34": 257,
            "lyr-4-35": 258,
            "lyr-4-36": 259,
            "lyr-4-37": 260,
            "lyr-4-38": 261,
            "lyr-4-39": 263,
            "lyr-4-40": 265,
            "lyr-4-41": 266,
            "lyr-4-42": 267,
            "lyr-4-43": 269,
            "lyr-4-44": 269,
            "lyr-4-45": 271,
            "lyr-4-46": 273,
            "lyr-4-47": 275,
            "lyr-4-48": 276,
            "lyr-4-49": 277,
            "epod-1": 279,
            "epod-2": 283,
            "epod-3": 285,
            "epod-4": 286,
            "epod-5": 289,
            "epod-6": 291,
            "epod-7": 292,
            "epod-8": 296,
            "epod-9": 297,
            "epod-10": 299,
            "epod-11": 300,
            "epod-12": 301,
            "epod-13": 304,
            "epod-14": 304,
            "epod-15": 307,
            "epod-16": 310,
            "epod-17": 313,
            "epod-18": 314,
            "epod-19": 318,
            "epod-20": 320,
            "epod-21": 324,
        }
    },
    "lyrica_1660": {
        "manifest": "https://api.digitale-sammlungen.de/iiif/presentation/v2/bsb10609929/manifest",
        "pages": {
            "lyr-3-1": 123,
            "lyr-3-31": 162,
            "lyr-3-32": 163,
            "lyr-3-33": 166,
            "lyr-3-34": 167,
            "lyr-3-35": 169,
            "lyr-3-36": 171,
            "lyr-3-37": 172,
            "lyr-3-38": 173,
            "lyr-3-39": 175,
            "lyr-3-40": 177,
            "lyr-3-41": 177,
            "lyr-3-42": 178,
            "lyr-3-43": 180,
            "lyr-3-44": 181,
            "lyr-3-45": 182,
            "lyr-3-46": 185,
            "lyr-3-47": 186,
            "lyr-3-48": 189,
        }
    },
    "lyrica_1729": {
        "manifest": "https://api.digitale-sammlungen.de/iiif/presentation/v2/bsb10712436/manifest",
        "pages": {
            "lyr-3-31": 177,
            "lyr-3-32": 179,
            "lyr-3-33": 181,
            "lyr-3-34": 182,
            "lyr-3-35": 184,
            "lyr-3-36": 187,
            "lyr-3-37": 188,
            "lyr-3-38": 189,
            "lyr-3-39": 190,
            "lyr-3-40": 192,
            "lyr-3-41": 193,
            "lyr-3-42": 194,
            "lyr-3-43": 196,
            "lyr-3-44": 197,
            "lyr-3-45": 198,
            "lyr-3-46": 201,
            "lyr-3-47": 202,
            "lyr-3-48": 205,
        }
    },
    "lyrica_1805": {
        "manifest": "https://api.digitale-sammlungen.de/iiif/presentation/v2/bsb10608714/manifest",
        "pages": {
            "lyr-3-15": 155,
            "lyr-3-17": 158,
            "lyr-3-20": 160,
            "lyr-3-21": 162,
            "lyr-3-24": 164,
            "lyr-3-25": 165,
            "lyr-3-27": 166,
            "lyr-3-31": 167,
            "lyr-3-32": 170,
            "lyr-3-33": 174,
            "lyr-3-34": 175,
            "lyr-3-35": 179,
            "lyr-3-36": 183,
            "lyr-3-37": 185,
            "lyr-3-43": 186,
            "lyr-3-44": 188,
            "lyr-3-45": 189,
            "lyr-3-47": 194,
            "lyr-3-48": 198,
        }
    },
    "lyrica_1844": {
        "manifest": "https://api.digitale-sammlungen.de/iiif/presentation/v2/bsb10608720/manifest",
        "pages": {
            "lyr-3-31": 276,
            "lyr-3-32": 279,
            "lyr-3-33": 282,
            "lyr-3-34": 284,
            "lyr-3-35": 287,
            "lyr-3-36": 290,
            "lyr-3-37": 292,
            "lyr-3-38": 293,
            "lyr-3-39": 296,
            "lyr-3-40": 298,
            "lyr-3-41": 299,
            "lyr-3-42": 301,
            "lyr-3-43": 304,
            "lyr-3-44": 306,
            "lyr-3-45": 307,
            "lyr-3-46": 311,
            "lyr-3-47": 314,
            "lyr-3-48": 319,
        }
    }
}

// Tify script is declared in HTML file.
// @ts-ignore
const tifyLyrica1643 = new Tify({
    manifestUrl: iiifRefs.lyrica_1643.manifest,
});
// @ts-ignore
const tifyLyrica1660 = new Tify({
    manifestUrl: iiifRefs.lyrica_1660.manifest,
});
// @ts-ignore
const tifyLyrica1729 = new Tify({
    manifestUrl: iiifRefs.lyrica_1729.manifest,
});
// @ts-ignore
const tifyLyrica1805 = new Tify({
    manifestUrl: iiifRefs.lyrica_1805.manifest,
});
// @ts-ignore
const tifyLyrica1844 = new Tify({
    manifestUrl: iiifRefs.lyrica_1844.manifest,
});

const tifys = {}
tifys["lyrica_1643"] = tifyLyrica1643;
tifys["lyrica_1660"] = tifyLyrica1660;
tifys["lyrica_1729"] = tifyLyrica1729;
tifys["lyrica_1805"] = tifyLyrica1805;
tifys["lyrica_1844"] = tifyLyrica1844;

document.addEventListener("DOMContentLoaded", initialLoad);

function initialLoad() {
    var checkboxes = document.getElementsByTagName("input");
    for (var c of checkboxes) {
        c.checked = false;
    }
    var frames = document.getElementsByClassName("content-field");
    for (var f of frames) {
        f.classList.add("display-none");
    }
    var texts = document.getElementsByClassName("edition");
    for (var tx of texts) {
        tx.classList.add("display-none");
    }
    mountTifys();
}

function mountTifys() {
    tifyLyrica1643.mount("#tify_lyrica_1643");
    tifyLyrica1660.mount("#tify_lyrica_1660");
    tifyLyrica1729.mount("#tify_lyrica_1729");
    tifyLyrica1805.mount("#tify_lyrica_1805");
    tifyLyrica1844.mount("#tify_lyrica_1844");
}

function synchroniseAll(textId) {
    selectText(textId)
    synchroniseScans(textId)
}

function selectText(textId) {
    var texts = document.getElementsByClassName("edition");
    for (var tx of texts) {
        tx.classList.add("display-none");
    }
    var textToShow = document.getElementById(textId);
    if (textToShow) {
        textToShow.classList.remove("display-none");
    } else {
        console.debug("Not available: '" + textId + "' for Lyrica edd. Baldeani");
        document.getElementById("edition-placeholder")?.classList.remove("display-none");
    }
}

function synchroniseScans(textId) {
    setPageIfAvailable("lyrica_1643", textId);
    setPageIfAvailable("lyrica_1660", textId);
    setPageIfAvailable("lyrica_1729", textId);
    setPageIfAvailable("lyrica_1805", textId);
    setPageIfAvailable("lyrica_1844", textId);
}

function setPageIfAvailable(edition, textId) {
    let tify = tifys[edition]
    let page = iiifRefs[edition]?.pages[textId]
    if (tify && page) {
        tify.ready.then(() =>
            tify.setPage(page))
    } else {
        console.debug("Not available: '" + textId + "' for '" + edition + "'")
    }
}

function toggleEdition(editionId) {
    const optionField = document.getElementById(`hf_${editionId}`);
    optionField?.classList.toggle("header-field-selected");
    const frame = document.getElementById(editionId);
    frame?.classList.toggle("display-none");
    if (numberOfFieldsAtDisplay() > 0) {
        const placeholder = document.getElementById("placeholder");
        placeholder?.classList.add("display-none");
    } else {
        const placeholder = document.getElementById("placeholder");
        placeholder?.classList.remove("display-none");
    }
}

function numberOfFieldsAtDisplay() {
    const editionContainers = document.getElementsByClassName('content-field');
    var n = editionContainers.length;
    for (var ec of editionContainers) {
        if (ec.classList.value.includes("display-none")) {
            n -= 1;
        }
    }
    return n;
}

function editionAtDisplay() {
    const editions = document.getElementsByClassName('edition')
    for (var e of editions) {
        if (!e.classList.value.includes("display-none")) {
            return e.id;
        }
    }
}